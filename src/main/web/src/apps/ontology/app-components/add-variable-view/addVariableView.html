<div class="om-av-view">

	<button class="btn btn-default" ng-click="goBack()">{{'button.back' | translate}}</button>

	<h2>{{'addNew.variable.title' | translate}}</h2>

	<div ng-if="serverErrors.general" class="alert alert-danger" role="alert">
		<ul>
			<li ng-repeat="error in serverErrors.general">{{error}}</li>
		</ul>
	</div>

	<form class="form-horizontal" name="avForm" ng-submit="saveVariable($event, variable)" novalidate>

		<div ng-class="formGroupClass('omName')">
			<label for="omName" class="col-sm-2 control-label">{{'formField.name' | translate}}</label>
			<div class="col-sm-10">
				<om-input om-name="omName" om-property="name" om-adding="true" om-model="variable" om-required="true" om-max-length="32" om-pattern="^[a-zA-Z_%][a-zA-Z_%0-9]*$"></om-input>
				<ng-messages for="avForm.omName.$error" ng-if="avForm.$submitted || avForm.omName.$touched">
					<ng-message when="required"><p class="text-danger">{{'validation.variable.nameRequired' | translate}}</p></ng-message>
					<ng-message when="maxlength"><p class="text-danger">{{'validation.tooLong' | translate:'{maxLength: "32"}'}}</p></ng-message>
					<ng-message when="pattern"><p class="text-danger">{{'validation.variable.pattern' | translate}}</p></ng-message>
				</ng-messages>
			</div>
		</div>

		<div ng-class="formGroupClass('omDescription')">
			<label for="omDescription" class="col-sm-2 control-label">{{'formField.description' | translate}}</label>
			<div class="col-sm-10">
				<om-text-area om-name="omDescription" om-property="description" om-adding="true" om-model="variable" om-max-length="255"></om-text-area>
				<ng-messages for="avForm.omDescription.$error" ng-if="avForm.$submitted || avForm.omDescription.$touched">
					<ng-message when="maxlength"><p class="text-danger">{{'validation.tooLong' | translate:'{maxLength: "255"}'}}</p></ng-message>
				</ng-messages>
			</div>
		</div>

		<div ng-class="formGroupClass('omProperty')">
			<label for="omProperty" class="col-sm-2 control-label">{{'formField.property' | translate}}</label>
			<div class="col-sm-10">
				<om-select name="omProperty" om-name="om-property" om-property="propertySummary" om-adding="true" ng-model="variable" om-options="data.properties" om-required="true"></om-select>
				<a href="#" ng-click="addNew($event, 'property')">{{'addNew.variable.addProperty' | translate}}</a>
				<ng-messages for="avForm.omProperty.$error" ng-if="avForm.$submitted">
					<ng-message when="required"><p class="text-danger">{{'validation.variable.propertyRequired' | translate}}</p></ng-message>
				</ng-messages>
			</div>
		</div>

		<div ng-class="formGroupClass('omMethod')">
			<label for="omMethod" class="col-sm-2 control-label">{{'formField.method' | translate}}</label>
			<div class="col-sm-10">
				<om-select name="omMethod" om-name="om-method" om-property="methodSummary" om-adding="true" ng-model="variable" om-options="data.methods" om-required="true"></om-select>
				<a href="#" ng-click="addNew($event, 'method')">{{'addNew.variable.addMethod' | translate}}</a>
				<ng-messages for="avForm.omMethod.$error" ng-if="avForm.$submitted">
					<ng-message when="required"><p class="text-danger">{{'validation.variable.methodRequired' | translate}}</p></ng-message>
				</ng-messages>
			</div>
		</div>

		<div ng-class="formGroupClass('omScale')">
			<label for="omScale" class="col-sm-2 control-label">{{'formField.scale' | translate}}</label>
			<div class="col-sm-10">
				<om-select name="omScale" om-name="om-scale" om-property="scale" om-adding="true" ng-model="variable" om-options="data.scales" om-required="true"></om-select>
				<a href="#" ng-click="addNew($event, 'scale')">{{'addNew.variable.addScale' | translate}}</a>
				<ng-messages for="avForm.omScale.$error" ng-if="avForm.$submitted">
					<ng-message when="required"><p class="text-danger">{{'validation.variable.scaleRequired' | translate}}</p></ng-message>
				</ng-messages>
			</div>
		</div>

		<div ng-class="formGroupClass('omVariableTypes')">
			<label for="omVariableTypes" class="col-sm-2 control-label">{{'formField.variableType' | translate}}</label>
			<div class="col-sm-10">
				<om-multi-select name="omVariableTypes" om-name="om-type" om-property="variableTypes" om-adding="true" ng-model="variable" om-options="data.types"></om-multi-select>
				<ng-messages for="avForm.omVariableTypes.$error" ng-if="avForm.$submitted">
					<ng-message when="emptyValue"><p class="text-danger">{{'validation.variable.variableTypeEmpty' | translate}}</p></ng-message>
				</ng-messages>
			</div>
		</div>

		<div ng-show="showRangeWidget">
			<span>{{'addNew.variable.expectedRange' | translate}}</span>
			<om-range name="omRange" om-property="expectedRange" om-adding="true" ng-model="variable" om-numeric="showRangeWidget" om-min="variable.scale.validValues.min" om-max="variable.scale.validValues.max"></om-range>

			<ng-messages for="avForm.omRange.$error" ng-if="avForm.$submitted">
				<ng-message when="minTooBig">{{'validation.minTooBig' | translate}}</ng-message>
				<ng-message when="minOutOfRange">{{'validation.variable.minOutOfRange' | translate: variable.scale.validValues}}</ng-message>
				<ng-message when="maxOutOfRange">{{'validation.variable.maxOutOfRange' | translate: variable.scale.validValues}}</ng-message>
			</ng-messages>
		</div>

		<div class="form-group">
			<div class="col-sm-offset-2 col-sm-10">
				<input class="btn btn-primary" type="submit" value="{{'button.save' | translate}}"></input>
			</div>
		</div>
	</form>
</div>
